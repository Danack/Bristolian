# Auto-Generated Directories and Files - Bristolian

This document describes directories and files that are automatically generated by the build process and should not be manually edited.

## Generated Directories

### `/app/public/js/`
**Purpose**: Compiled JavaScript output from TypeScript source
**Generated by**: Webpack build process
**Source**: `/app/public/tsx/` (TypeScript files)
**Generation Command**: 
```bash
npm run js:build:dev    # Development build
npm run js:build:prod   # Production build
```
**Key Files**:
- `app.bundle.js` - Main application bundle
- `app.bundle.map` - Source map for debugging
- `stats.json` - Webpack bundle analysis

### `/app/public/css/`
**Purpose**: Compiled CSS output from Sass source
**Generated by**: Sass compiler
**Source**: `/app/public/scss/` (Sass files)
**Generation Command**:
```bash
npm run sass:build:dev    # Development build
npm run sass:build:prod   # Production build
```
**Key Files**:
- `site.css` - Main stylesheet
- `site.css.map` - Source map for debugging

### `/app/public/tsx/generated/`
**Purpose**: TypeScript files generated from PHP source
**Generated by**: CLI commands run inside Docker containers
**Source**: PHP classes and constants
**Generation Commands**:
```bash
# Run CLI commands inside the php_fpm container:
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:javascript_constants"
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:javascript_types"

# Or regenerate both at once:
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:all_javascript_files"
```
**Key Files**:
- `constants.tsx` - Constants shared between PHP and JavaScript (validation limits, form field names, etc.)
- `types.tsx` - TypeScript interfaces generated from PHP models
- `readme.md` - Documentation about the generated files

**When to regenerate**:
- After adding new constants to parameter type classes (e.g., length limits)
- After adding new PHP models that need TypeScript interfaces
- After adding new enums that are used in both PHP and TypeScript

### `/src/Bristolian/Database/`
**Purpose**: PHP helper classes for database operations
**Generated by**: CLI command run inside Docker containers
**Source**: Database schema analysis
**Generation Command**:
```bash
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:php_table_helper_classes"
```
**Key Files**: One PHP class per database table (e.g., `user.php`, `room.php`)

**Note**: These are typically auto-generated when bouncing Docker containers, but can be manually regenerated with the command above.

## Generated Files

### `config.generated.php`
**Purpose**: Runtime configuration file
**Generated by**: ClassConfig tool
**Source**: `config.source.php`
**Generation Command**:
```bash
vendor/bin/classconfig -p config.source.php Bristolian\Config\Config config.generated.php default,local
```
**Contains**: Environment-specific configuration values

### `composer.lock`
**Purpose**: Lock file for Composer dependencies
**Generated by**: Composer
**Source**: `composer.json`
**Generation Command**:
```bash
composer install
composer update
```

### `app/package-lock.json`
**Purpose**: Lock file for NPM dependencies
**Generated by**: NPM
**Source**: `app/package.json`
**Generation Command**:
```bash
npm install
npm update
```

## Build Process Integration

### Docker Build Process
The auto-generation is integrated into the Docker build process:

1. **Installer Container**: Runs Composer and NPM installs
2. **JS Builder Container**: Compiles TypeScript and Sass
3. **Sass Dev Builder Container**: Watches and compiles Sass files
4. **CLI Commands**: Generate database helpers and JavaScript constants

### Development Workflow

PHP/Composer commands run in the `php_fpm` container; npm/node commands run in the `js_builder` container (see project root `.cursorrules`).

```bash
# Full development setup (includes generation)
./runLocal.sh

# Manual generation commands (run inside php_fpm container)
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:javascript_constants"
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:php_table_helper_classes"

# Frontend builds (run inside js_builder container)
docker exec bristolian-js_builder-1 bash -c "npm run js:build:dev:watch"
docker exec bristolian-js_builder-1 bash -c "npm run sass:build:watch"
```

## Files to Never Edit Manually

### JavaScript/CSS Output
- `/app/public/js/*.js`
- `/app/public/js/*.map`
- `/app/public/css/*.css`
- `/app/public/css/*.map`

### Generated TypeScript
- `/app/public/tsx/generated/constants.tsx`
- `/app/public/tsx/generated/types.tsx`

### Database Helpers
- `/src/Bristolian/Database/*.php`

### Configuration
- `config.generated.php`
- `composer.lock`
- `app/package-lock.json`

### Build Artifacts
- `app/public/js/stats.json`
- `app/public/js/report.html`

## Regeneration Triggers

### Automatic Regeneration
- **Docker build**: All generated files are recreated
- **File watching**: Sass and TypeScript files are watched for changes
- **Database migrations**: Database helper classes should be regenerated

### Manual Regeneration

Run PHP/Composer commands in the `php_fpm` container and npm commands in the `js_builder` container.

```bash
# Regenerate all JavaScript constants and types (php_fpm container)
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:javascript_constants"

# Regenerate database helper classes (php_fpm container)
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:php_table_helper_classes"

# Regenerate configuration (php_fpm container, from project root)
docker exec bristolian-php_fpm-1 bash -c "vendor/bin/classconfig -p config.source.php Bristolian\Config\Config config.generated.php default,local"

# Rebuild frontend assets (js_builder container)
docker exec bristolian-js_builder-1 bash -c "npm run js:build:dev"
docker exec bristolian-js_builder-1 bash -c "npm run sass:build:dev"
```

## Troubleshooting

### Common Issues
1. **Outdated generated files**: Run the appropriate generation command (in the correct container; see Manual Regeneration above).
2. **Build failures**: Check that source files are valid
3. **Missing dependencies**: Run `composer install` in the php_fpm container or `npm install` in the js_builder container

### Verification
```bash
# Check if generated files are up to date (php_fpm container)
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:javascript_constants --dry-run"

# Verify database helpers match current schema (php_fpm container)
docker exec bristolian-php_fpm-1 bash -c "php cli.php generate:php_table_helper_classes --check"
```

## Git Integration

### Ignored Files
The following generated files are in `.gitignore`:
- `/app/public/js/app.bundle.js`
- `/app/public/js/app.bundle.map`
- `/app/public/css/site.css`
- `/app/public/css/site.css.map`
- `/app/public/tsx/generated/constants.tsx`
- `/app/public/tsx/generated/types.tsx`
- `/src/Bristolian/Database/*.php`
- `config.generated.php`

### CI/CD Considerations
- Generated files should be recreated during deployment
- Source files should be version controlled
- Build process should be reproducible across environments

---

*These directories and files are automatically generated and should not be manually edited. Always modify the source files and regenerate as needed.*

